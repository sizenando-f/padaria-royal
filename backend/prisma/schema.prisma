// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Producao {
  id        Int      @id @default(autoincrement())

  // Controle Temporal
  dataProducao  DateTime @default(now())
  horaInicio    DateTime
  horaFim       DateTime

  // Calculado automaticamente pelo backend (diferença entre fim e inicio)
  tempoFermentacaoMinutos  Int 

  // Temperatura (Serão preenchidas via API ou manualmente)
  tempAmbienteInicial   Decimal?  @db.Decimal(5,2)
  tempAmbienteFinal     Decimal?  @db.Decimal(5,2)

  // Ingredientes
  farinhaKg       Decimal @db.Decimal(10, 3) // 3 casas (ex: 10.500)
  emulsificanteMl Decimal @db.Decimal(10, 2)
  fermentoGrama   Decimal @db.Decimal(10, 2)

  observacoes String? @db.Text

  // Relacionamento inverso (O prisma cria isso pra facilitar a busca)
  avaliacao Avaliacao?
}

model Avaliacao {
  id        Int      @id @default(autoincrement())
  
  // Chave Estrangeira ligando à Fornada
  producaoId Int     @unique
  producao   Producao @relation(fields: [producaoId], references: [id], onDelete: Cascade)

  nota      Int     // 1=Péssimo, 2=Ruim, 3=Regual, 4= Bom, 5=Excelente
  comentario String?

  tempAmbienteFinalReal Decimal?
}